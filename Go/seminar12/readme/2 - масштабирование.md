# Масштабирование

## Типы масштабирования

Выделяют 2 типа масштабирования — горизонтальное и вертикальное. 

Примеры вертикального масштабирования:

- увеличение `GOMAXPROCS` для приложения на golang
- увеличение доступных CPU и памяти для контейнера с помощью [docker-compose](https://docs.docker.com/reference/compose-file/deploy/#resources)
- увеличение размера батча, который обрабатывает один воркер
- увеличение [максимального количества коннектов](https://postgrespro.ru/docs/postgresql/17/runtime-config-connection#GUC-MAX-CONNECTIONS) в postgres

Примеры горизонтального масштабирования:

- увеличение числа запущенных горутин при использовании паттерна Worker Pool
- добавление партиций в топик kafka
- добавление новых мастер-нод в кластер redis
- увеличение количества подов k8s, которые обрабатывают запросы

## Проблемы при масштабировании

### Несогласованность конфигурации приложения и инфраструктуры

[Пример](../code/app02) — приложение с пулом воркеров. В нём можно изменять:

- количество ядер CPU, выделенное под контейнер с приложением
- количество воркеров в пуле
- `GOMAXPROCS`

### Влияние на зависимости

Частый сценарий при масштабировании k8s-приложения, работающего с postgres:

1. Увеличение количества подов с приложением влечёт увеличение количества коннектов к БД.
2. Всем подам может перестать хватать подключений, если не увеличить соответственно настройку max_connections в postgres.
3. Postgres создаёт по одному процессу ОС для каждого подключения. Это может привести к тому, что ресурсов хоста перестанет хватать, и потребуется масштабирование уже БД.
